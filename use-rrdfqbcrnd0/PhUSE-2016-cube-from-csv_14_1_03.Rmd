---
title: "Create CDISC pilot tables"
author: "mja@statgroup.dk"
date: "`r Sys.Date()`"
output:
  html_document:
    toc: true
    theme: united
  pdf_document:
    toc: true
    highlight: zenburn
  md_document:
    variant: markdown_github
---


# Setup

This script creates RDF data cubes from .csv files.

```{r}
library(rrdfancillary)
library(rrdfcdisc)
library(rrdfqb)
library(rrdfqbcrnd0)
```

All files are stored in the directory
```{r}
targetDir<- "../res-ttl"
(targetDir)
```


# Create from .csv files

The files are generated by a SAS program gen-res-sas/tab1x01.sas.  The input files are read
directly from .csv files instead of using the workbook, to avoid the
extra step with the workbook, as the input files may be updated by
running the SAS program.

```{r, eval=TRUE}
tab1x03ObsDataCsvFn<- file.path("../res-csv", "TAB1X03.csv")
tab1x03ObsData <- read.csv(tab1x03ObsDataCsvFn,stringsAsFactors=FALSE)


tab1x03MetaDataCsvFn<- file.path("../res-csv", "TAB1X03-Components.csv")
tab1x03MetaData <- read.csv(tab1x03MetaDataCsvFn,stringsAsFactors=FALSE)


tab1x03.cube.fn<- BuildCubeFromDataFrames(tab1x03MetaData, tab1x03ObsData )
cat("TAB1X03 cube stored as ", normalizePath(tab1x03.cube.fn), "\n")

targetFile<- file.path(targetDir,"CDISC-pilot-TAB1X03.ttl")

if (file.copy( tab1x03.cube.fn, targetFile, overwrite=TRUE)) {
   cat("RDF data cube copied to ", normalizePath(targetFile), "\n")
 }
```


Now look at the generated cubes by loading the turtle files. 

```{r, echo=TRUE, results='asis'}
dataCubeFile<- targetFile
```


The rest of the code only depends on the value of dataCubeFile.

```{r, echo=TRUE}
checkCube <- new.rdf(ontology=FALSE)  # Initialize
cat("Loading RDF data cube from ", normalizePath(dataCubeFile), "\n")
temp<- load.rdf(dataCubeFile, format="TURTLE", appendTo= checkCube)
summarize.rdf(checkCube)

```

# Session information
```{r, echo=TRUE}
sessionInfo()
```

